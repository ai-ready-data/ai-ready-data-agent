# Consumable factor suite for Snowflake
# Factor 2: Is the data served in the right format and at the right latencies for AI workloads?
# Reference: /factors.md â€” Accessible (Consumable) section
# Requirement keys match agent/requirements_registry.yaml
suite_name: consumable_snowflake
platform: snowflake

tests:
  - id: clustering_coverage
    factor: consumable
    requirement: clustering_coverage
    query: >-
      SELECT COUNT_IF(clustering_key IS NOT NULL AND clustering_key != '') * 1.0 / NULLIF(COUNT(*), 0) AS v
      FROM information_schema.tables
      WHERE UPPER(table_schema) NOT IN ('INFORMATION_SCHEMA', 'PG_CATALOG')
        AND table_type = 'BASE TABLE'
        AND row_count > 10000
    target_type: platform

  - id: search_optimization_coverage
    factor: consumable
    requirement: search_optimization_coverage
    query: >-
      SELECT COUNT_IF(search_optimization = 'ON') * 1.0 / NULLIF(COUNT(*), 0) AS v
      FROM information_schema.tables
      WHERE UPPER(table_schema) NOT IN ('INFORMATION_SCHEMA', 'PG_CATALOG')
        AND table_type = 'BASE TABLE'
    target_type: platform
